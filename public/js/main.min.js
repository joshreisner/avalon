$(function(){$("form").validate({errorElement:"span",errorClass:"help-inline",onfocusout:!1,onkeyup:function(e){},highlight:function(e,t,n){$(e).closest("div.form-group").addClass("has-error")},unhighlight:function(e,t,n){$(e).closest("div.form-group").removeClass("has-error")}});$("form input[type=text]:not(.color)").first().focus();$("table.draggable").tableDnD({dragHandle:".draggy",onDragClass:"dragging",onDrop:function(e,t){$.post($(e).attr("data-draggable-url"),{order:$(e).tableDnDSerialize()},function(e){}).fail(function(){})}});$("div.nested > ul").nestedSortable({listType:"ul",forcePlaceholderSize:!0,handle:"div.draggy",helper:"clone",items:"li",opacity:.8,tabSize:30,delay:300,placeholder:"placeholder",tolerance:"pointer",toleranceElement:"> div",protectRoot:!1,update:function(e,t){var n=t.item.attr("id").substr(5),r=$("div.nested > ul").nestedSortable("toArray",{startDepthCount:0}),i=new Array,s=!1;for(var o=0;o<r.length;o++){r[o].item_id!="root"&&(i[i.length]=r[o].item_id);r[o].item_id==n&&(s=r[o].parent_id)}$.post($("div.nested").first().attr("data-draggable-url"),{id:n,parent_id:s,list:i.join(",")},function(e){})}});$("table").on("click","td.delete a",function(e){e.preventDefault();var t=$(this).closest("tr");t.toggleClass("inactive");if(t.hasClass("inactive")){var n=0;$(this).find("i").removeClass("glyphicon-ok-circle").addClass("glyphicon-remove-circle")}else{var n=1;$(this).find("i").removeClass("glyphicon-remove-circle").addClass("glyphicon-ok-circle")}$.get($(this).attr("href"),{active:n},function(e){t.find("td.updated_at").html(e)}).fail(function(){})});$("div.nested").on("click","div.delete a",function(e){e.preventDefault();var t=$(this).closest("div.nested_row");t.toggleClass("inactive");if(t.hasClass("inactive")){var n=0;$(this).find("i").removeClass("glyphicon-ok-circle").addClass("glyphicon-remove-circle")}else{var n=1;$(this).find("i").removeClass("glyphicon-remove-circle").addClass("glyphicon-ok-circle")}$.get($(this).attr("href"),{active:n},function(e){t.find("div.updated_at").html(e)}).fail(function(){})});$("textarea.html").redactor({minHeight:200,buttonsAdd:["|","button1"],buttonsCustom:{button1:{title:"Lorem Ipsum",callback:function(e,t,n){editor=this;$.getJSON("http://hipsterjesus.com/api/",function(e){$(".redactor_act").removeClass("redactor_act");editor.set(e.text);editor.focusEnd()})}}}});$("input.slug").each(function(){$(this).on("keyup",function(){var e=$(this).val();e=e.toLowerCase().replace(/ /g,"-").replace(/\-\-/g,"-").replace(/[^a-z0-9\-]/g,"");$(this).val(e)})});$("input.typeahead").each(function(){var e=$(this);console.log("hi");$.getJSON(e.attr("data-typeahead"),function(t){e.typeahead({source:t});console.log("there"+t)})});$("div.image_upload").each(function(){var e=$(this).offset(),t=$(this).width(),n=$(this).height(),r=$(this).attr("id").substr(6);$("<form class='upload upload_image'><input type='hidden' name='field_id' value='"+r+"'><input type='file' name='image'></form>").appendTo("body").css({top:e.top,left:e.left,width:t,height:n,display:"block"})});$("form.upload_image input").fileupload({url:"/login/upload/image",type:"POST",dataType:"text",acceptFileTypes:/(\.|\/)(jpg|gif|png)$/i,autoUpload:!0,add:function(e,t){t.submit()},fail:function(e,t){window.console.log("fail "+t.jqXHR.responseText)},done:function(e,t){var n=t.jqXHR.responseText,r=$(this).parent().find("input[name=field_id]").val();console.log(n+" "+r);$("div#image_"+r).css("backgroundImage","url("+n+")").addClass("filled").next().val(n)}})});