$(function(){function e(e,t){e=e.trim().toLowerCase();e=e.replace(/[^a-z0-9]+/g,"-");e=e.replace(/^-|-$/g,"");t&&e.length>t&&(e=e.substr(0,t));e.substr(e.length-1)=="-"&&(e=e.substr(0,e.length-1));return e}function t(e){var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function n(n){if(n.indexOf(".")==-1)return!1;var r=n.split("."),i=r.pop();i=="jpeg"&&(i="jpg");var s=new Array("jpg","png","gif");if($.inArray(i,s)==-1){alert("extension "+i+" is invalid for this field.  Please use jpg, png or gif.");return!1}var o="images/"+e(r.join("."),20)+"-"+t(5)+"."+i;return o}$("form").validate({errorElement:"span",errorClass:"help-inline",onfocusout:!1,onkeyup:function(e){},highlight:function(e,t,n){$(e).closest("div.form-group").addClass("has-error")},unhighlight:function(e,t,n){$(e).closest("div.form-group").removeClass("has-error")}});$("form input[type=text]:not(.color)").first().focus();$("table.draggable").tableDnD({dragHandle:".draggy",onDragClass:"dragging",onDrop:function(e,t){$.post($(e).attr("data-draggable-url"),{order:$(e).tableDnDSerialize()},function(e){}).fail(function(){})}});$("div.nested > ul").nestedSortable({listType:"ul",forcePlaceholderSize:!0,handle:"div.draggy",helper:"clone",items:"li",opacity:.8,tabSize:30,delay:300,placeholder:"placeholder",tolerance:"pointer",toleranceElement:"> div",protectRoot:!1,update:function(e,t){var n=t.item.attr("id").substr(5),r=$("div.nested > ul").nestedSortable("toArray",{startDepthCount:0}),i=new Array,s=!1;for(var o=0;o<r.length;o++){r[o].item_id!="root"&&(i[i.length]=r[o].item_id);r[o].item_id==n&&(s=r[o].parent_id)}$.post($("div.nested").first().attr("data-draggable-url"),{id:n,parent_id:s,list:i.join(",")},function(e){$(".side .inner").html(e)})}});$("table").on("click","td.delete a",function(e){e.preventDefault();var t=$(this).closest("tr");t.toggleClass("inactive");if(t.hasClass("inactive")){var n=0;$(this).find("i").removeClass("glyphicon-ok-circle").addClass("glyphicon-remove-circle")}else{var n=1;$(this).find("i").removeClass("glyphicon-remove-circle").addClass("glyphicon-ok-circle")}$.get($(this).attr("href"),{active:n},function(e){t.find("td.updated_at").html(e)}).fail(function(){})});$("textarea.html").redactor({minHeight:200,buttonsAdd:["|","button1"],buttonsCustom:{button1:{title:"Lorem Ipsum",callback:function(e,t,n){editor=this;$.getJSON("http://hipsterjesus.com/api/",function(e){$(".redactor_act").removeClass("redactor_act");editor.set(e.text);editor.focusEnd()})}}}});$("input.slug").each(function(){$(this).on("keyup",function(){var e=$(this).val();e=e.toLowerCase().replace(/ /g,"-").replace(/\-\-/g,"-").replace(/[^a-z0-9\-]/g,"");$(this).val(e)})});$("input.typeahead").each(function(){var e=$(this);console.log("hi");$.getJSON(e.attr("data-typeahead"),function(t){e.typeahead({source:t});console.log("there"+t)})});var r=$(".control-group.images .controls"),i=new Array;$("input#image_upload").fileupload({url:$(this).closest("form").attr("action"),type:"POST",dataType:"xml",acceptFileTypes:/(\.|\/)(jpg|gif|png)$/i,autoUpload:!0,dropZone:r,add:function(e,t){if(t.filename=n(t.files[0].name)){t.context=$('<div class="image loading"/>').html('<div class="progress progress-striped active"><div class="bar"></div></div>').appendTo(r);$(this).closest("form").find("input[name=filename]").val(t.filename);t.submit()}},fail:function(e,t){window.console.log("fail");window.console.log(t)},progress:function(e,t){var n=Math.round(e.loaded/e.total*100);$(t.context).find(".bar").css("width",n+"%")},done:function(e,t){window.console.log("done");var n=document.createElement("img");n.src="https://s3.amazonaws.com/josh-reisner-dot-com/"+t.filename;$(t.context).removeClass("loading").html(n);i[i.length]=t.filename;$("input[name=images]").val(i.join("|"))}});window.addEventListener("dragover",function(e){e=e||event;e.preventDefault()},!1);window.addEventListener("drop",function(e){e=e||event;e.preventDefault()},!1)});$(window).load(function(){$("img.upload").each(function(){var e=$(this).offset(),t=$(this).width(),n=$(this).height();$("<form class='upload upload_image' name='"+$(this).attr("alt")+"'><input type='hidden' name='field_id' value='"+$(this).attr("data-field")+"'><input type='file' name='image'></form>").appendTo("body").css({top:e.top,left:e.left,width:t,height:n,display:"block"})});$("form.upload_image input").fileupload({url:"/login/upload/image",type:"POST",dataType:"text",acceptFileTypes:/(\.|\/)(jpg|gif|png)$/i,autoUpload:!0,add:function(e,t){t.submit()},fail:function(e,t){window.console.log("fail "+t.jqXHR.responseText)},done:function(e,t){window.console.log("done "+t.jqXHR.responseText);console.log($(this).parent().attr("name"))}})});